"use strict";
(self["webpackChunkmm"] = self["webpackChunkmm"] || []).push([["node_modules_arcgis_core_views_3d_layers_PointCloudWorker_js"],{

/***/ "./node_modules/@arcgis/core/views/3d/layers/PointCloudWorker.js":
/*!***********************************************************************!*\
  !*** ./node_modules/@arcgis/core/views/3d/layers/PointCloudWorker.js ***!
  \***********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ h)
/* harmony export */ });
/* harmony import */ var _core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../core/arrayUtils.js */ "./node_modules/@arcgis/core/core/arrayUtils.js");
/* harmony import */ var _core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../core/typedArrayUtil.js */ "./node_modules/@arcgis/core/core/typedArrayUtil.js");
/* harmony import */ var _chunks_quat_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../chunks/quat.js */ "./node_modules/@arcgis/core/chunks/quat.js");
/* harmony import */ var _chunks_quatf64_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../chunks/quatf64.js */ "./node_modules/@arcgis/core/chunks/quatf64.js");
/* harmony import */ var _chunks_vec3_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../chunks/vec3.js */ "./node_modules/@arcgis/core/chunks/vec3.js");
/* harmony import */ var _chunks_vec3f32_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../chunks/vec3f32.js */ "./node_modules/@arcgis/core/chunks/vec3f32.js");
/* harmony import */ var _geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../geometry/SpatialReference.js */ "./node_modules/@arcgis/core/geometry/SpatialReference.js");
/* harmony import */ var _geometry_projection_projectBuffer_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../geometry/projection/projectBuffer.js */ "./node_modules/@arcgis/core/geometry/projection/projectBuffer.js");
/* harmony import */ var _i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./i3s/PointCloudWorkerUtil.js */ "./node_modules/@arcgis/core/views/3d/layers/i3s/PointCloudWorkerUtil.js");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
class p{transform(t){const e=this._transform(t),a=[e.points.buffer,e.rgb.buffer];null!=e.pointIdFilterMap&&a.push(e.pointIdFilterMap.buffer);for(const o of e.attributes)"buffer"in o.values&&(0,_core_typedArrayUtil_js__WEBPACK_IMPORTED_MODULE_1__.isArrayBuffer)(o.values.buffer)&&o.values.buffer!==e.rgb.buffer&&a.push(o.values.buffer);return Promise.resolve({result:e,transferList:a})}_transform(r){const e=(0,_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.readGeometry)(r.schema,r.geometryBuffer);let a=e.length/3,o=null;const n=new Array,f=(0,_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.getAttributeValues)(r.primaryAttributeData,e,a);null!=r.primaryAttributeData&&f&&n.push({attributeInfo:r.primaryAttributeData.attributeInfo,values:f});const s=(0,_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.getAttributeValues)(r.modulationAttributeData,e,a);null!=r.modulationAttributeData&&s&&n.push({attributeInfo:r.modulationAttributeData.attributeInfo,values:s});let p=(0,_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.evaluateRenderer)(r.rendererInfo,f,s,a);if(r.filterInfo&&r.filterInfo.length>0&&null!=r.filterAttributesData){const f=r.filterAttributesData.filter(_core_arrayUtils_js__WEBPACK_IMPORTED_MODULE_0__.isSome).map((t=>{const r=(0,_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.getAttributeValues)(t,e,a),o={attributeInfo:t.attributeInfo,values:r};return n.push(o),o}));o=new Uint32Array(a),a=(0,_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.filterInPlace)(e,p,o,r.filterInfo,f)}for(const t of r.userAttributesData){const r=(0,_i3s_PointCloudWorkerUtil_js__WEBPACK_IMPORTED_MODULE_8__.getAttributeValues)(t,e,a);n.push({attributeInfo:t.attributeInfo,values:r})}3*a<p.length&&(p=new Uint8Array(p.buffer.slice(0,3*a))),this._applyElevationOffsetInPlace(e,a,r.elevationOffset);const c=this._transformCoordinates(e,a,r.obb,_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_6__["default"].fromJSON(r.inSR),_geometry_SpatialReference_js__WEBPACK_IMPORTED_MODULE_6__["default"].fromJSON(r.outSR));return{obb:r.obb,points:c,rgb:p,attributes:n,pointIdFilterMap:o}}_transformCoordinates(t,r,a,i,u){if(!(0,_geometry_projection_projectBuffer_js__WEBPACK_IMPORTED_MODULE_7__.projectBuffer)(t,i,0,t,u,0,r))throw new Error("Can't reproject");const l=(0,_chunks_vec3f32_js__WEBPACK_IMPORTED_MODULE_5__.f)(a.center[0],a.center[1],a.center[2]),b=(0,_chunks_vec3f32_js__WEBPACK_IMPORTED_MODULE_5__.c)(),m=(0,_chunks_vec3f32_js__WEBPACK_IMPORTED_MODULE_5__.c)();(0,_chunks_quat_js__WEBPACK_IMPORTED_MODULE_2__.a)(c,a.quaternion);const p=new Float32Array(3*r);for(let e=0;e<r;e++)b[0]=t[3*e]-l[0],b[1]=t[3*e+1]-l[1],b[2]=t[3*e+2]-l[2],(0,_chunks_vec3_js__WEBPACK_IMPORTED_MODULE_4__.v)(m,b,c),a.halfSize[0]=Math.max(a.halfSize[0],Math.abs(m[0])),a.halfSize[1]=Math.max(a.halfSize[1],Math.abs(m[1])),a.halfSize[2]=Math.max(a.halfSize[2],Math.abs(m[2])),p[3*e]=b[0],p[3*e+1]=b[1],p[3*e+2]=b[2];return p}_applyElevationOffsetInPlace(t,r,e){if(0!==e)for(let a=0;a<r;a++)t[3*a+2]+=e}}const c=(0,_chunks_quatf64_js__WEBPACK_IMPORTED_MODULE_3__.a)();function h(){return new p}


/***/ }),

/***/ "./node_modules/@arcgis/core/views/3d/layers/i3s/PointCloudWorkerUtil.js":
/*!*******************************************************************************!*\
  !*** ./node_modules/@arcgis/core/views/3d/layers/i3s/PointCloudWorkerUtil.js ***!
  \*******************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   elevationFromPositions: () => (/* binding */ a),
/* harmony export */   evaluateRenderer: () => (/* binding */ i),
/* harmony export */   filterInPlace: () => (/* binding */ f),
/* harmony export */   getAttributeValues: () => (/* binding */ c),
/* harmony export */   readGeometry: () => (/* binding */ u)
/* harmony export */ });
/* harmony import */ var _core_has_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../core/has.js */ "./node_modules/@arcgis/core/core/has.js");
/* harmony import */ var _renderers_PointCloudClassBreaksRenderer_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../renderers/PointCloudClassBreaksRenderer.js */ "./node_modules/@arcgis/core/renderers/PointCloudClassBreaksRenderer.js");
/* harmony import */ var _renderers_PointCloudStretchRenderer_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../renderers/PointCloudStretchRenderer.js */ "./node_modules/@arcgis/core/renderers/PointCloudStretchRenderer.js");
/* harmony import */ var _renderers_PointCloudUniqueValueRenderer_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../renderers/PointCloudUniqueValueRenderer.js */ "./node_modules/@arcgis/core/renderers/PointCloudUniqueValueRenderer.js");
/* harmony import */ var _I3SBinaryReader_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./I3SBinaryReader.js */ "./node_modules/@arcgis/core/views/3d/layers/i3s/I3SBinaryReader.js");
/* harmony import */ var _LEPCC_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./LEPCC.js */ "./node_modules/@arcgis/core/views/3d/layers/i3s/LEPCC.js");
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.28/esri/copyright.txt for details.
*/
function i(t,n,l,s){const{rendererJSON:i,isRGBRenderer:u}=t;let c=null,a=null;if(n&&u)c=n;else if(n&&"pointCloudUniqueValueRenderer"===i?.type){a=_renderers_PointCloudUniqueValueRenderer_js__WEBPACK_IMPORTED_MODULE_3__["default"].fromJSON(i);const e=a.colorUniqueValueInfos;c=new Uint8Array(3*s);const r=d(a.fieldTransformType);for(let o=0;o<s;o++){const t=(r?r(n[o]):n[o])+"";for(let r=0;r<e.length;r++)if(e[r].values.includes(t)){c[3*o]=e[r].color.r,c[3*o+1]=e[r].color.g,c[3*o+2]=e[r].color.b;break}}}else if(n&&"pointCloudStretchRenderer"===i?.type){a=_renderers_PointCloudStretchRenderer_js__WEBPACK_IMPORTED_MODULE_2__["default"].fromJSON(i);const e=a.stops;c=new Uint8Array(3*s);const o=d(a.fieldTransformType);for(let r=0;r<s;r++){const t=o?o(n[r]):n[r],l=e.length-1;if(t<e[0].value)c[3*r]=e[0].color.r,c[3*r+1]=e[0].color.g,c[3*r+2]=e[0].color.b;else if(t>=e[l].value)c[3*r]=e[l].color.r,c[3*r+1]=e[l].color.g,c[3*r+2]=e[l].color.b;else for(let o=1;o<e.length;o++)if(t<e[o].value){const n=(t-e[o-1].value)/(e[o].value-e[o-1].value);c[3*r]=e[o].color.r*n+e[o-1].color.r*(1-n),c[3*r+1]=e[o].color.g*n+e[o-1].color.g*(1-n),c[3*r+2]=e[o].color.b*n+e[o-1].color.b*(1-n);break}}}else if(n&&"pointCloudClassBreaksRenderer"===i?.type){a=_renderers_PointCloudClassBreaksRenderer_js__WEBPACK_IMPORTED_MODULE_1__["default"].fromJSON(i);const r=a.colorClassBreakInfos;c=new Uint8Array(3*s);const o=d(a.fieldTransformType);for(let e=0;e<s;e++){const t=o?o(n[e]):n[e];for(let o=0;o<r.length;o++)if(t>=r[o].minValue&&t<=r[o].maxValue){c[3*e]=r[o].color.r,c[3*e+1]=r[o].color.g,c[3*e+2]=r[o].color.b;break}}}else c=new Uint8Array(3*s).fill(255);if(l&&a?.colorModulation){const e=a.colorModulation.minValue,r=a.colorModulation.maxValue,o=.3;for(let t=0;t<s;t++){const n=l[t],s=n>=r?1:n<=e?o:o+(1-o)*(n-e)/(r-e);c[3*t]=s*c[3*t],c[3*t+1]=s*c[3*t+1],c[3*t+2]=s*c[3*t+2]}}return c}function u(e,r){if(null==e.encoding||""===e.encoding){const o=(0,_I3SBinaryReader_js__WEBPACK_IMPORTED_MODULE_4__.createGeometryIndexFromSchema)(r,e);if(null==o.vertexAttributes.position)return;const l=(0,_I3SBinaryReader_js__WEBPACK_IMPORTED_MODULE_4__.createTypedView)(r,o.vertexAttributes.position),s=o.header.fields,i=[s.offsetX,s.offsetY,s.offsetZ],u=[s.scaleX,s.scaleY,s.scaleZ],c=l.length/3,a=new Float64Array(3*c);for(let e=0;e<c;e++)a[3*e]=l[3*e]*u[0]+i[0],a[3*e+1]=l[3*e+1]*u[1]+i[1],a[3*e+2]=l[3*e+2]*u[2]+i[2];return a}if("lepcc-xyz"===e.encoding)return (0,_LEPCC_js__WEBPACK_IMPORTED_MODULE_5__.decodeXYZ)(r).result}function c(e,r,o){return e?.attributeInfo.useElevation?r?a(r,o):null:e?.attributeInfo.storageInfo?(0,_I3SBinaryReader_js__WEBPACK_IMPORTED_MODULE_4__.readBinaryAttribute)(e.attributeInfo.storageInfo,e.buffer,o):null}function a(e,r){const o=new Float64Array(r);for(let t=0;t<r;t++)o[t]=e[3*t+2];return o}function f(e,r,o,t,n){const l=e.length/3;let s=0;for(let i=0;i<l;i++){let l=!0;for(let e=0;e<t.length&&l;e++){const{filterJSON:r}=t[e],o=n[e].values[i];switch(r.type){case"pointCloudValueFilter":{const e="exclude"===r.mode;r.values.includes(o)===e&&(l=!1);break}case"pointCloudBitfieldFilter":{const e=p(r.requiredSetBits),t=p(r.requiredClearBits);(o&e)===e&&0==(o&t)||(l=!1);break}case"pointCloudReturnFilter":{const e=15&o,t=o>>>4&15,n=t>1,s=1===e,i=e===t;let u=!1;for(const o of r.includedReturns)if("last"===o&&i||"firstOfMany"===o&&s&&n||"lastOfMany"===o&&i&&n||"single"===o&&!n){u=!0;break}u||(l=!1);break}}}l&&(o[s]=i,e[3*s]=e[3*i],e[3*s+1]=e[3*i+1],e[3*s+2]=e[3*i+2],r[3*s]=r[3*i],r[3*s+1]=r[3*i+1],r[3*s+2]=r[3*i+2],s++)}return s}function d(e){switch(e){default:case null:case"none":return e=>e;case"low-four-bit":return e=>15&e;case"high-four-bit":return e=>(240&e)>>4;case"absolute-value":return e=>Math.abs(e);case"modulo-ten":return e=>e%10}}function p(e){let r=0;for(const o of e||[])r|=1<<o;return r}


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZV9tb2R1bGVzX2FyY2dpc19jb3JlX3ZpZXdzXzNkX2xheWVyc19Qb2ludENsb3VkV29ya2VyX2pzLmJ1bmRsZS5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDOGlCLFFBQVEsYUFBYSw0REFBNEQsNERBQTRELGlEQUFpRCxzRUFBQywyRUFBMkUsd0JBQXdCLHdCQUF3QixFQUFFLGNBQWMsUUFBUSwwRUFBQyw0QkFBNEIsd0JBQXdCLG9CQUFvQixnRkFBQyw2QkFBNkIseUNBQXlDLDREQUE0RCxFQUFFLFFBQVEsZ0ZBQUMsZ0NBQWdDLDRDQUE0QywrREFBK0QsRUFBRSxNQUFNLDhFQUFDLHVCQUF1QixzRUFBc0Usc0NBQXNDLHVEQUFDLFdBQVcsUUFBUSxnRkFBQyxXQUFXLHdDQUF3QyxtQkFBbUIsR0FBRyx1QkFBdUIsMkVBQUMsdUJBQXVCLHFDQUFxQyxRQUFRLGdGQUFDLFFBQVEsUUFBUSx1Q0FBdUMsRUFBRSxpSEFBaUgsNkNBQTZDLHFFQUFDLGtCQUFrQixxRUFBQyxvQkFBb0IsT0FBTywwREFBMEQsaUNBQWlDLElBQUksb0ZBQUMsbURBQW1ELFFBQVEscURBQUMsd0NBQXdDLHFEQUFDLEtBQUsscURBQUMsR0FBRyxrREFBQyxpQkFBaUIsOEJBQThCLFlBQVksSUFBSSwyREFBMkQsa0RBQUMsK01BQStNLFNBQVMsb0NBQW9DLHFCQUFxQixJQUFJLGlCQUFpQixRQUFRLHFEQUFDLEdBQUcsYUFBYSxhQUFrQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ0oxOUU7QUFDQTtBQUNBO0FBQ0E7QUFDd1ksb0JBQW9CLE1BQU0sK0JBQStCLEdBQUcsa0JBQWtCLFlBQVksc0RBQXNELEVBQUUsbUZBQUMsYUFBYSxnQ0FBZ0Msc0JBQXNCLGdDQUFnQyxZQUFZLElBQUksS0FBSyw0QkFBNEIsWUFBWSxXQUFXLGdDQUFnQyxnRUFBZ0UsUUFBUSxrREFBa0QsRUFBRSwrRUFBQyxhQUFhLGdCQUFnQixzQkFBc0IsZ0NBQWdDLFlBQVksSUFBSSxLQUFLLG9DQUFvQyxnRkFBZ0Ysc0ZBQXNGLGlCQUFpQixXQUFXLHFCQUFxQixtREFBbUQscUlBQXFJLFFBQVEsc0RBQXNELEVBQUUsbUZBQUMsYUFBYSwrQkFBK0Isc0JBQXNCLGdDQUFnQyxZQUFZLElBQUksS0FBSyx1QkFBdUIsWUFBWSxXQUFXLDJDQUEyQyxnRUFBZ0UsUUFBUSxxQ0FBcUMsMEJBQTBCLHFFQUFxRSxZQUFZLElBQUksS0FBSyxpREFBaUQseURBQXlELFNBQVMsZ0JBQWdCLHNDQUFzQyxRQUFRLGtGQUFDLE1BQU0sNENBQTRDLFFBQVEsb0VBQUMsd0pBQXdKLFlBQVksSUFBSSxvRkFBb0YsU0FBUyxtQ0FBbUMsb0RBQUMsV0FBVyxrQkFBa0IsZ0ZBQWdGLHdFQUFDLDhDQUE4QyxnQkFBZ0IsNEJBQTRCLFlBQVksSUFBSSxrQkFBa0IsU0FBUyxzQkFBc0IsbUJBQW1CLFFBQVEsWUFBWSxJQUFJLEtBQUssU0FBUyxZQUFZLGNBQWMsS0FBSyxNQUFNLGFBQWEsdUJBQXVCLGVBQWUsNkJBQTZCLDJCQUEyQixpQ0FBaUMsTUFBTSxnQ0FBZ0Msc0RBQXNELDRCQUE0QixNQUFNLDhCQUE4Qiw4Q0FBOEMsU0FBUyxzSEFBc0gsS0FBSyxNQUFNLFVBQVUsUUFBUSxvSEFBb0gsU0FBUyxjQUFjLFVBQVUseUNBQXlDLGtDQUFrQyx5Q0FBeUMsMkNBQTJDLGlDQUFpQyxjQUFjLFFBQVEsNkJBQTZCLFNBQWdJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbW0vLi9ub2RlX21vZHVsZXMvQGFyY2dpcy9jb3JlL3ZpZXdzLzNkL2xheWVycy9Qb2ludENsb3VkV29ya2VyLmpzIiwid2VicGFjazovL21tLy4vbm9kZV9tb2R1bGVzL0BhcmNnaXMvY29yZS92aWV3cy8zZC9sYXllcnMvaTNzL1BvaW50Q2xvdWRXb3JrZXJVdGlsLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5BbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuU2VlIGh0dHBzOi8vanMuYXJjZ2lzLmNvbS80LjI4L2VzcmkvY29weXJpZ2h0LnR4dCBmb3IgZGV0YWlscy5cbiovXG5pbXBvcnR7aXNTb21lIGFzIHR9ZnJvbVwiLi4vLi4vLi4vY29yZS9hcnJheVV0aWxzLmpzXCI7aW1wb3J0e2lzQXJyYXlCdWZmZXIgYXMgcn1mcm9tXCIuLi8uLi8uLi9jb3JlL3R5cGVkQXJyYXlVdGlsLmpzXCI7aW1wb3J0e2EgYXMgZX1mcm9tXCIuLi8uLi8uLi9jaHVua3MvcXVhdC5qc1wiO2ltcG9ydHthfWZyb21cIi4uLy4uLy4uL2NodW5rcy9xdWF0ZjY0LmpzXCI7aW1wb3J0e3YgYXMgb31mcm9tXCIuLi8uLi8uLi9jaHVua3MvdmVjMy5qc1wiO2ltcG9ydHtmIGFzIG4sYyBhcyBmfWZyb21cIi4uLy4uLy4uL2NodW5rcy92ZWMzZjMyLmpzXCI7aW1wb3J0IGkgZnJvbVwiLi4vLi4vLi4vZ2VvbWV0cnkvU3BhdGlhbFJlZmVyZW5jZS5qc1wiO2ltcG9ydHtwcm9qZWN0QnVmZmVyIGFzIHN9ZnJvbVwiLi4vLi4vLi4vZ2VvbWV0cnkvcHJvamVjdGlvbi9wcm9qZWN0QnVmZmVyLmpzXCI7aW1wb3J0e3JlYWRHZW9tZXRyeSBhcyB1LGdldEF0dHJpYnV0ZVZhbHVlcyBhcyBsLGV2YWx1YXRlUmVuZGVyZXIgYXMgYixmaWx0ZXJJblBsYWNlIGFzIG19ZnJvbVwiLi9pM3MvUG9pbnRDbG91ZFdvcmtlclV0aWwuanNcIjtjbGFzcyBwe3RyYW5zZm9ybSh0KXtjb25zdCBlPXRoaXMuX3RyYW5zZm9ybSh0KSxhPVtlLnBvaW50cy5idWZmZXIsZS5yZ2IuYnVmZmVyXTtudWxsIT1lLnBvaW50SWRGaWx0ZXJNYXAmJmEucHVzaChlLnBvaW50SWRGaWx0ZXJNYXAuYnVmZmVyKTtmb3IoY29uc3QgbyBvZiBlLmF0dHJpYnV0ZXMpXCJidWZmZXJcImluIG8udmFsdWVzJiZyKG8udmFsdWVzLmJ1ZmZlcikmJm8udmFsdWVzLmJ1ZmZlciE9PWUucmdiLmJ1ZmZlciYmYS5wdXNoKG8udmFsdWVzLmJ1ZmZlcik7cmV0dXJuIFByb21pc2UucmVzb2x2ZSh7cmVzdWx0OmUsdHJhbnNmZXJMaXN0OmF9KX1fdHJhbnNmb3JtKHIpe2NvbnN0IGU9dShyLnNjaGVtYSxyLmdlb21ldHJ5QnVmZmVyKTtsZXQgYT1lLmxlbmd0aC8zLG89bnVsbDtjb25zdCBuPW5ldyBBcnJheSxmPWwoci5wcmltYXJ5QXR0cmlidXRlRGF0YSxlLGEpO251bGwhPXIucHJpbWFyeUF0dHJpYnV0ZURhdGEmJmYmJm4ucHVzaCh7YXR0cmlidXRlSW5mbzpyLnByaW1hcnlBdHRyaWJ1dGVEYXRhLmF0dHJpYnV0ZUluZm8sdmFsdWVzOmZ9KTtjb25zdCBzPWwoci5tb2R1bGF0aW9uQXR0cmlidXRlRGF0YSxlLGEpO251bGwhPXIubW9kdWxhdGlvbkF0dHJpYnV0ZURhdGEmJnMmJm4ucHVzaCh7YXR0cmlidXRlSW5mbzpyLm1vZHVsYXRpb25BdHRyaWJ1dGVEYXRhLmF0dHJpYnV0ZUluZm8sdmFsdWVzOnN9KTtsZXQgcD1iKHIucmVuZGVyZXJJbmZvLGYscyxhKTtpZihyLmZpbHRlckluZm8mJnIuZmlsdGVySW5mby5sZW5ndGg+MCYmbnVsbCE9ci5maWx0ZXJBdHRyaWJ1dGVzRGF0YSl7Y29uc3QgZj1yLmZpbHRlckF0dHJpYnV0ZXNEYXRhLmZpbHRlcih0KS5tYXAoKHQ9Pntjb25zdCByPWwodCxlLGEpLG89e2F0dHJpYnV0ZUluZm86dC5hdHRyaWJ1dGVJbmZvLHZhbHVlczpyfTtyZXR1cm4gbi5wdXNoKG8pLG99KSk7bz1uZXcgVWludDMyQXJyYXkoYSksYT1tKGUscCxvLHIuZmlsdGVySW5mbyxmKX1mb3IoY29uc3QgdCBvZiByLnVzZXJBdHRyaWJ1dGVzRGF0YSl7Y29uc3Qgcj1sKHQsZSxhKTtuLnB1c2goe2F0dHJpYnV0ZUluZm86dC5hdHRyaWJ1dGVJbmZvLHZhbHVlczpyfSl9MyphPHAubGVuZ3RoJiYocD1uZXcgVWludDhBcnJheShwLmJ1ZmZlci5zbGljZSgwLDMqYSkpKSx0aGlzLl9hcHBseUVsZXZhdGlvbk9mZnNldEluUGxhY2UoZSxhLHIuZWxldmF0aW9uT2Zmc2V0KTtjb25zdCBjPXRoaXMuX3RyYW5zZm9ybUNvb3JkaW5hdGVzKGUsYSxyLm9iYixpLmZyb21KU09OKHIuaW5TUiksaS5mcm9tSlNPTihyLm91dFNSKSk7cmV0dXJue29iYjpyLm9iYixwb2ludHM6YyxyZ2I6cCxhdHRyaWJ1dGVzOm4scG9pbnRJZEZpbHRlck1hcDpvfX1fdHJhbnNmb3JtQ29vcmRpbmF0ZXModCxyLGEsaSx1KXtpZighcyh0LGksMCx0LHUsMCxyKSl0aHJvdyBuZXcgRXJyb3IoXCJDYW4ndCByZXByb2plY3RcIik7Y29uc3QgbD1uKGEuY2VudGVyWzBdLGEuY2VudGVyWzFdLGEuY2VudGVyWzJdKSxiPWYoKSxtPWYoKTtlKGMsYS5xdWF0ZXJuaW9uKTtjb25zdCBwPW5ldyBGbG9hdDMyQXJyYXkoMypyKTtmb3IobGV0IGU9MDtlPHI7ZSsrKWJbMF09dFszKmVdLWxbMF0sYlsxXT10WzMqZSsxXS1sWzFdLGJbMl09dFszKmUrMl0tbFsyXSxvKG0sYixjKSxhLmhhbGZTaXplWzBdPU1hdGgubWF4KGEuaGFsZlNpemVbMF0sTWF0aC5hYnMobVswXSkpLGEuaGFsZlNpemVbMV09TWF0aC5tYXgoYS5oYWxmU2l6ZVsxXSxNYXRoLmFicyhtWzFdKSksYS5oYWxmU2l6ZVsyXT1NYXRoLm1heChhLmhhbGZTaXplWzJdLE1hdGguYWJzKG1bMl0pKSxwWzMqZV09YlswXSxwWzMqZSsxXT1iWzFdLHBbMyplKzJdPWJbMl07cmV0dXJuIHB9X2FwcGx5RWxldmF0aW9uT2Zmc2V0SW5QbGFjZSh0LHIsZSl7aWYoMCE9PWUpZm9yKGxldCBhPTA7YTxyO2ErKyl0WzMqYSsyXSs9ZX19Y29uc3QgYz1hKCk7ZnVuY3Rpb24gaCgpe3JldHVybiBuZXcgcH1leHBvcnR7aCBhcyBkZWZhdWx0fTtcbiIsIi8qXG5BbGwgbWF0ZXJpYWwgY29weXJpZ2h0IEVTUkksIEFsbCBSaWdodHMgUmVzZXJ2ZWQsIHVubGVzcyBvdGhlcndpc2Ugc3BlY2lmaWVkLlxuU2VlIGh0dHBzOi8vanMuYXJjZ2lzLmNvbS80LjI4L2VzcmkvY29weXJpZ2h0LnR4dCBmb3IgZGV0YWlscy5cbiovXG5pbXBvcnRcIi4uLy4uLy4uLy4uL2NvcmUvaGFzLmpzXCI7aW1wb3J0IGUgZnJvbVwiLi4vLi4vLi4vLi4vcmVuZGVyZXJzL1BvaW50Q2xvdWRDbGFzc0JyZWFrc1JlbmRlcmVyLmpzXCI7aW1wb3J0IHIgZnJvbVwiLi4vLi4vLi4vLi4vcmVuZGVyZXJzL1BvaW50Q2xvdWRTdHJldGNoUmVuZGVyZXIuanNcIjtpbXBvcnQgbyBmcm9tXCIuLi8uLi8uLi8uLi9yZW5kZXJlcnMvUG9pbnRDbG91ZFVuaXF1ZVZhbHVlUmVuZGVyZXIuanNcIjtpbXBvcnR7Y3JlYXRlR2VvbWV0cnlJbmRleEZyb21TY2hlbWEgYXMgdCxjcmVhdGVUeXBlZFZpZXcgYXMgbixyZWFkQmluYXJ5QXR0cmlidXRlIGFzIGx9ZnJvbVwiLi9JM1NCaW5hcnlSZWFkZXIuanNcIjtpbXBvcnR7ZGVjb2RlWFlaIGFzIHN9ZnJvbVwiLi9MRVBDQy5qc1wiO2Z1bmN0aW9uIGkodCxuLGwscyl7Y29uc3R7cmVuZGVyZXJKU09OOmksaXNSR0JSZW5kZXJlcjp1fT10O2xldCBjPW51bGwsYT1udWxsO2lmKG4mJnUpYz1uO2Vsc2UgaWYobiYmXCJwb2ludENsb3VkVW5pcXVlVmFsdWVSZW5kZXJlclwiPT09aT8udHlwZSl7YT1vLmZyb21KU09OKGkpO2NvbnN0IGU9YS5jb2xvclVuaXF1ZVZhbHVlSW5mb3M7Yz1uZXcgVWludDhBcnJheSgzKnMpO2NvbnN0IHI9ZChhLmZpZWxkVHJhbnNmb3JtVHlwZSk7Zm9yKGxldCBvPTA7bzxzO28rKyl7Y29uc3QgdD0ocj9yKG5bb10pOm5bb10pK1wiXCI7Zm9yKGxldCByPTA7cjxlLmxlbmd0aDtyKyspaWYoZVtyXS52YWx1ZXMuaW5jbHVkZXModCkpe2NbMypvXT1lW3JdLmNvbG9yLnIsY1szKm8rMV09ZVtyXS5jb2xvci5nLGNbMypvKzJdPWVbcl0uY29sb3IuYjticmVha319fWVsc2UgaWYobiYmXCJwb2ludENsb3VkU3RyZXRjaFJlbmRlcmVyXCI9PT1pPy50eXBlKXthPXIuZnJvbUpTT04oaSk7Y29uc3QgZT1hLnN0b3BzO2M9bmV3IFVpbnQ4QXJyYXkoMypzKTtjb25zdCBvPWQoYS5maWVsZFRyYW5zZm9ybVR5cGUpO2ZvcihsZXQgcj0wO3I8cztyKyspe2NvbnN0IHQ9bz9vKG5bcl0pOm5bcl0sbD1lLmxlbmd0aC0xO2lmKHQ8ZVswXS52YWx1ZSljWzMqcl09ZVswXS5jb2xvci5yLGNbMypyKzFdPWVbMF0uY29sb3IuZyxjWzMqcisyXT1lWzBdLmNvbG9yLmI7ZWxzZSBpZih0Pj1lW2xdLnZhbHVlKWNbMypyXT1lW2xdLmNvbG9yLnIsY1szKnIrMV09ZVtsXS5jb2xvci5nLGNbMypyKzJdPWVbbF0uY29sb3IuYjtlbHNlIGZvcihsZXQgbz0xO288ZS5sZW5ndGg7bysrKWlmKHQ8ZVtvXS52YWx1ZSl7Y29uc3Qgbj0odC1lW28tMV0udmFsdWUpLyhlW29dLnZhbHVlLWVbby0xXS52YWx1ZSk7Y1szKnJdPWVbb10uY29sb3IucipuK2Vbby0xXS5jb2xvci5yKigxLW4pLGNbMypyKzFdPWVbb10uY29sb3IuZypuK2Vbby0xXS5jb2xvci5nKigxLW4pLGNbMypyKzJdPWVbb10uY29sb3IuYipuK2Vbby0xXS5jb2xvci5iKigxLW4pO2JyZWFrfX19ZWxzZSBpZihuJiZcInBvaW50Q2xvdWRDbGFzc0JyZWFrc1JlbmRlcmVyXCI9PT1pPy50eXBlKXthPWUuZnJvbUpTT04oaSk7Y29uc3Qgcj1hLmNvbG9yQ2xhc3NCcmVha0luZm9zO2M9bmV3IFVpbnQ4QXJyYXkoMypzKTtjb25zdCBvPWQoYS5maWVsZFRyYW5zZm9ybVR5cGUpO2ZvcihsZXQgZT0wO2U8cztlKyspe2NvbnN0IHQ9bz9vKG5bZV0pOm5bZV07Zm9yKGxldCBvPTA7bzxyLmxlbmd0aDtvKyspaWYodD49cltvXS5taW5WYWx1ZSYmdDw9cltvXS5tYXhWYWx1ZSl7Y1szKmVdPXJbb10uY29sb3IucixjWzMqZSsxXT1yW29dLmNvbG9yLmcsY1szKmUrMl09cltvXS5jb2xvci5iO2JyZWFrfX19ZWxzZSBjPW5ldyBVaW50OEFycmF5KDMqcykuZmlsbCgyNTUpO2lmKGwmJmE/LmNvbG9yTW9kdWxhdGlvbil7Y29uc3QgZT1hLmNvbG9yTW9kdWxhdGlvbi5taW5WYWx1ZSxyPWEuY29sb3JNb2R1bGF0aW9uLm1heFZhbHVlLG89LjM7Zm9yKGxldCB0PTA7dDxzO3QrKyl7Y29uc3Qgbj1sW3RdLHM9bj49cj8xOm48PWU/bzpvKygxLW8pKihuLWUpLyhyLWUpO2NbMyp0XT1zKmNbMyp0XSxjWzMqdCsxXT1zKmNbMyp0KzFdLGNbMyp0KzJdPXMqY1szKnQrMl19fXJldHVybiBjfWZ1bmN0aW9uIHUoZSxyKXtpZihudWxsPT1lLmVuY29kaW5nfHxcIlwiPT09ZS5lbmNvZGluZyl7Y29uc3Qgbz10KHIsZSk7aWYobnVsbD09by52ZXJ0ZXhBdHRyaWJ1dGVzLnBvc2l0aW9uKXJldHVybjtjb25zdCBsPW4ocixvLnZlcnRleEF0dHJpYnV0ZXMucG9zaXRpb24pLHM9by5oZWFkZXIuZmllbGRzLGk9W3Mub2Zmc2V0WCxzLm9mZnNldFkscy5vZmZzZXRaXSx1PVtzLnNjYWxlWCxzLnNjYWxlWSxzLnNjYWxlWl0sYz1sLmxlbmd0aC8zLGE9bmV3IEZsb2F0NjRBcnJheSgzKmMpO2ZvcihsZXQgZT0wO2U8YztlKyspYVszKmVdPWxbMyplXSp1WzBdK2lbMF0sYVszKmUrMV09bFszKmUrMV0qdVsxXStpWzFdLGFbMyplKzJdPWxbMyplKzJdKnVbMl0raVsyXTtyZXR1cm4gYX1pZihcImxlcGNjLXh5elwiPT09ZS5lbmNvZGluZylyZXR1cm4gcyhyKS5yZXN1bHR9ZnVuY3Rpb24gYyhlLHIsbyl7cmV0dXJuIGU/LmF0dHJpYnV0ZUluZm8udXNlRWxldmF0aW9uP3I/YShyLG8pOm51bGw6ZT8uYXR0cmlidXRlSW5mby5zdG9yYWdlSW5mbz9sKGUuYXR0cmlidXRlSW5mby5zdG9yYWdlSW5mbyxlLmJ1ZmZlcixvKTpudWxsfWZ1bmN0aW9uIGEoZSxyKXtjb25zdCBvPW5ldyBGbG9hdDY0QXJyYXkocik7Zm9yKGxldCB0PTA7dDxyO3QrKylvW3RdPWVbMyp0KzJdO3JldHVybiBvfWZ1bmN0aW9uIGYoZSxyLG8sdCxuKXtjb25zdCBsPWUubGVuZ3RoLzM7bGV0IHM9MDtmb3IobGV0IGk9MDtpPGw7aSsrKXtsZXQgbD0hMDtmb3IobGV0IGU9MDtlPHQubGVuZ3RoJiZsO2UrKyl7Y29uc3R7ZmlsdGVySlNPTjpyfT10W2VdLG89bltlXS52YWx1ZXNbaV07c3dpdGNoKHIudHlwZSl7Y2FzZVwicG9pbnRDbG91ZFZhbHVlRmlsdGVyXCI6e2NvbnN0IGU9XCJleGNsdWRlXCI9PT1yLm1vZGU7ci52YWx1ZXMuaW5jbHVkZXMobyk9PT1lJiYobD0hMSk7YnJlYWt9Y2FzZVwicG9pbnRDbG91ZEJpdGZpZWxkRmlsdGVyXCI6e2NvbnN0IGU9cChyLnJlcXVpcmVkU2V0Qml0cyksdD1wKHIucmVxdWlyZWRDbGVhckJpdHMpOyhvJmUpPT09ZSYmMD09KG8mdCl8fChsPSExKTticmVha31jYXNlXCJwb2ludENsb3VkUmV0dXJuRmlsdGVyXCI6e2NvbnN0IGU9MTUmbyx0PW8+Pj40JjE1LG49dD4xLHM9MT09PWUsaT1lPT09dDtsZXQgdT0hMTtmb3IoY29uc3QgbyBvZiByLmluY2x1ZGVkUmV0dXJucylpZihcImxhc3RcIj09PW8mJml8fFwiZmlyc3RPZk1hbnlcIj09PW8mJnMmJm58fFwibGFzdE9mTWFueVwiPT09byYmaSYmbnx8XCJzaW5nbGVcIj09PW8mJiFuKXt1PSEwO2JyZWFrfXV8fChsPSExKTticmVha319fWwmJihvW3NdPWksZVszKnNdPWVbMyppXSxlWzMqcysxXT1lWzMqaSsxXSxlWzMqcysyXT1lWzMqaSsyXSxyWzMqc109clszKmldLHJbMypzKzFdPXJbMyppKzFdLHJbMypzKzJdPXJbMyppKzJdLHMrKyl9cmV0dXJuIHN9ZnVuY3Rpb24gZChlKXtzd2l0Y2goZSl7ZGVmYXVsdDpjYXNlIG51bGw6Y2FzZVwibm9uZVwiOnJldHVybiBlPT5lO2Nhc2VcImxvdy1mb3VyLWJpdFwiOnJldHVybiBlPT4xNSZlO2Nhc2VcImhpZ2gtZm91ci1iaXRcIjpyZXR1cm4gZT0+KDI0MCZlKT4+NDtjYXNlXCJhYnNvbHV0ZS12YWx1ZVwiOnJldHVybiBlPT5NYXRoLmFicyhlKTtjYXNlXCJtb2R1bG8tdGVuXCI6cmV0dXJuIGU9PmUlMTB9fWZ1bmN0aW9uIHAoZSl7bGV0IHI9MDtmb3IoY29uc3QgbyBvZiBlfHxbXSlyfD0xPDxvO3JldHVybiByfWV4cG9ydHthIGFzIGVsZXZhdGlvbkZyb21Qb3NpdGlvbnMsaSBhcyBldmFsdWF0ZVJlbmRlcmVyLGYgYXMgZmlsdGVySW5QbGFjZSxjIGFzIGdldEF0dHJpYnV0ZVZhbHVlcyx1IGFzIHJlYWRHZW9tZXRyeX07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=