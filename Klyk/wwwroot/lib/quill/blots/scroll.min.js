/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/quill@1.3.7/blots/scroll.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Parchment from"parchment";import Emitter from"../core/emitter";import Block,{BlockEmbed}from"./block";import Break from"./break";import CodeBlock from"../formats/code";import Container from"./container";function isLine(e){return e instanceof Block||e instanceof BlockEmbed}class Scroll extends Parchment.Scroll{constructor(e,t){super(e),this.emitter=t.emitter,Array.isArray(t.whitelist)&&(this.whitelist=t.whitelist.reduce(function(e,t){return e[t]=!0,e},{})),this.domNode.addEventListener("DOMNodeInserted",function(){}),this.optimize(),this.enable()}batchStart(){this.batch=!0}batchEnd(){this.batch=!1,this.optimize()}deleteAt(e,t){let[i,r]=this.line(e),[n]=this.line(e+t);if(super.deleteAt(e,t),null!=n&&i!==n&&r>0){if(i instanceof BlockEmbed||n instanceof BlockEmbed)return void this.optimize();if(i instanceof CodeBlock){let e=i.newlineIndex(i.length(),!0);if(e>-1&&(i=i.split(e+1))===n)return void this.optimize()}else if(n instanceof CodeBlock){let e=n.newlineIndex(0);e>-1&&n.split(e+1)}let e=n.children.head instanceof Break?null:n.children.head;i.moveChildren(n,e),i.remove()}this.optimize()}enable(e=!0){this.domNode.setAttribute("contenteditable",e)}formatAt(e,t,i,r){(null==this.whitelist||this.whitelist[i])&&(super.formatAt(e,t,i,r),this.optimize())}insertAt(e,t,i){if(null==i||null==this.whitelist||this.whitelist[t]){if(e>=this.length())if(null==i||null==Parchment.query(t,Parchment.Scope.BLOCK)){let e=Parchment.create(this.statics.defaultChild);this.appendChild(e),null==i&&t.endsWith("\n")&&(t=t.slice(0,-1)),e.insertAt(0,t,i)}else{let e=Parchment.create(t,i);this.appendChild(e)}else super.insertAt(e,t,i);this.optimize()}}insertBefore(e,t){if(e.statics.scope===Parchment.Scope.INLINE_BLOT){let t=Parchment.create(this.statics.defaultChild);t.appendChild(e),e=t}super.insertBefore(e,t)}leaf(e){return this.path(e).pop()||[null,-1]}line(e){return e===this.length()?this.line(e-1):this.descendant(isLine,e)}lines(e=0,t=Number.MAX_VALUE){let i=(e,t,r)=>{let n=[],l=r;return e.children.forEachAt(t,r,function(e,t,r){isLine(e)?n.push(e):e instanceof Parchment.Container&&(n=n.concat(i(e,t,l))),l-=r}),n};return i(this,e,t)}optimize(e=[],t={}){!0!==this.batch&&(super.optimize(e,t),e.length>0&&this.emitter.emit(Emitter.events.SCROLL_OPTIMIZE,e,t))}path(e){return super.path(e).slice(1)}update(e){if(!0===this.batch)return;let t=Emitter.sources.USER;"string"==typeof e&&(t=e),Array.isArray(e)||(e=this.observer.takeRecords()),e.length>0&&this.emitter.emit(Emitter.events.SCROLL_BEFORE_UPDATE,t,e),super.update(e.concat([])),e.length>0&&this.emitter.emit(Emitter.events.SCROLL_UPDATE,t,e)}}Scroll.blotName="scroll",Scroll.className="ql-editor",Scroll.tagName="DIV",Scroll.defaultChild="block",Scroll.allowedChildren=[Block,BlockEmbed,Container];export default Scroll;
//# sourceMappingURL=/sm/b7d1432d24ca7982c1a64829a5a2a41791a0e1f17074252a2a9aaa47c6aa4257.map