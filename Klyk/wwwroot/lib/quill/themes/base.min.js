/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/quill@1.3.7/themes/base.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import extend from"extend";import Delta from"quill-delta";import Emitter from"../core/emitter";import Keyboard from"../modules/keyboard";import Theme from"../core/theme";import ColorPicker from"../ui/color-picker";import IconPicker from"../ui/icon-picker";import Picker from"../ui/picker";import Tooltip from"../ui/tooltip";const ALIGNS=[!1,"center","right","justify"],COLORS=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],FONTS=[!1,"serif","monospace"],HEADERS=["1","2","3",!1],SIZES=["small",!1,"large","huge"];class BaseTheme extends Theme{constructor(t,e){super(t,e);let i=e=>{if(!document.body.contains(t.root))return document.body.removeEventListener("click",i);null==this.tooltip||this.tooltip.root.contains(e.target)||document.activeElement===this.tooltip.textbox||this.quill.hasFocus()||this.tooltip.hide(),null!=this.pickers&&this.pickers.forEach(function(t){t.container.contains(e.target)||t.close()})};t.emitter.listenDOM("click",document.body,i)}addModule(t){let e=super.addModule(t);return"toolbar"===t&&this.extendToolbar(e),e}buildButtons(t,e){t.forEach(t=>{(t.getAttribute("class")||"").split(/\s+/).forEach(i=>{if(i.startsWith("ql-")&&(i=i.slice("ql-".length),null!=e[i]))if("direction"===i)t.innerHTML=e[i][""]+e[i].rtl;else if("string"==typeof e[i])t.innerHTML=e[i];else{let l=t.value||"";null!=l&&e[i][l]&&(t.innerHTML=e[i][l])}})})}buildPickers(t,e){this.pickers=t.map(t=>{if(t.classList.contains("ql-align"))return null==t.querySelector("option")&&fillSelect(t,ALIGNS),new IconPicker(t,e.align);if(t.classList.contains("ql-background")||t.classList.contains("ql-color")){let i=t.classList.contains("ql-background")?"background":"color";return null==t.querySelector("option")&&fillSelect(t,COLORS,"background"===i?"#ffffff":"#000000"),new ColorPicker(t,e[i])}return null==t.querySelector("option")&&(t.classList.contains("ql-font")?fillSelect(t,FONTS):t.classList.contains("ql-header")?fillSelect(t,HEADERS):t.classList.contains("ql-size")&&fillSelect(t,SIZES)),new Picker(t)});this.quill.on(Emitter.events.EDITOR_CHANGE,()=>{this.pickers.forEach(function(t){t.update()})})}}BaseTheme.DEFAULTS=extend(!0,{},Theme.DEFAULTS,{modules:{toolbar:{handlers:{formula:function(){this.quill.theme.tooltip.edit("formula")},image:function(){let t=this.container.querySelector("input.ql-image[type=file]");null==t&&((t=document.createElement("input")).setAttribute("type","file"),t.setAttribute("accept","image/png, image/gif, image/jpeg, image/bmp, image/x-icon"),t.classList.add("ql-image"),t.addEventListener("change",()=>{if(null!=t.files&&null!=t.files[0]){let e=new FileReader;e.onload=(e=>{let i=this.quill.getSelection(!0);this.quill.updateContents((new Delta).retain(i.index).delete(i.length).insert({image:e.target.result}),Emitter.sources.USER),this.quill.setSelection(i.index+1,Emitter.sources.SILENT),t.value=""}),e.readAsDataURL(t.files[0])}}),this.container.appendChild(t)),t.click()},video:function(){this.quill.theme.tooltip.edit("video")}}}}});class BaseTooltip extends Tooltip{constructor(t,e){super(t,e),this.textbox=this.root.querySelector('input[type="text"]'),this.listen()}listen(){this.textbox.addEventListener("keydown",t=>{Keyboard.match(t,"enter")?(this.save(),t.preventDefault()):Keyboard.match(t,"escape")&&(this.cancel(),t.preventDefault())})}cancel(){this.hide()}edit(t="link",e=null){this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),null!=e?this.textbox.value=e:t!==this.root.getAttribute("data-mode")&&(this.textbox.value=""),this.position(this.quill.getBounds(this.quill.selection.savedRange)),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute(`data-${t}`)||""),this.root.setAttribute("data-mode",t)}restoreFocus(){let t=this.quill.scrollingContainer.scrollTop;this.quill.focus(),this.quill.scrollingContainer.scrollTop=t}save(){let t=this.textbox.value;switch(this.root.getAttribute("data-mode")){case"link":{let e=this.quill.root.scrollTop;this.linkRange?(this.quill.formatText(this.linkRange,"link",t,Emitter.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",t,Emitter.sources.USER)),this.quill.root.scrollTop=e;break}case"video":t=extractVideoUrl(t);case"formula":{if(!t)break;let e=this.quill.getSelection(!0);if(null!=e){let i=e.index+e.length;this.quill.insertEmbed(i,this.root.getAttribute("data-mode"),t,Emitter.sources.USER),"formula"===this.root.getAttribute("data-mode")&&this.quill.insertText(i+1," ",Emitter.sources.USER),this.quill.setSelection(i+2,Emitter.sources.USER)}break}}this.textbox.value="",this.hide()}}function extractVideoUrl(t){let e=t.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||t.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return e?(e[1]||"https")+"://www.youtube.com/embed/"+e[2]+"?showinfo=0":(e=t.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?(e[1]||"https")+"://player.vimeo.com/video/"+e[2]+"/":t}function fillSelect(t,e,i=!1){e.forEach(function(e){let l=document.createElement("option");e===i?l.setAttribute("selected","selected"):l.setAttribute("value",e),t.appendChild(l)})}export{BaseTooltip,BaseTheme as default};
//# sourceMappingURL=/sm/770823b76f545407c32f01a534fdb2d12abf2bd1001a1fb8dab2764d3d46fd22.map