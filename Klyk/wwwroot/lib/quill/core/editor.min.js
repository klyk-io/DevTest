/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/quill@1.3.7/core/editor.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Delta from"quill-delta";import DeltaOp from"quill-delta/lib/op";import Parchment from"parchment";import CodeBlock from"../formats/code";import CursorBlot from"../blots/cursor";import Block,{bubbleFormats}from"../blots/block";import Break from"../blots/break";import clone from"clone";import equal from"deep-equal";import extend from"extend";const ASCII=/^[ -~]*$/;class Editor{constructor(t){this.scroll=t,this.delta=this.getDelta()}applyDelta(t){let e=!1;this.scroll.update();let r=this.scroll.length();return this.scroll.batchStart(),(t=normalizeDelta(t)).reduce((t,l)=>{let n=l.retain||l.delete||l.insert.length||1,i=l.attributes||{};if(null!=l.insert){if("string"==typeof l.insert){let n=l.insert;n.endsWith("\n")&&e&&(e=!1,n=n.slice(0,-1)),t>=r&&!n.endsWith("\n")&&(e=!0),this.scroll.insertAt(t,n);let[s,a]=this.scroll.line(t),o=extend({},bubbleFormats(s));if(s instanceof Block){let[t]=s.descendant(Parchment.Leaf,a);o=extend(o,bubbleFormats(t))}i=DeltaOp.attributes.diff(o,i)||{}}else if("object"==typeof l.insert){let e=Object.keys(l.insert)[0];if(null==e)return t;this.scroll.insertAt(t,e,l.insert[e])}r+=n}return Object.keys(i).forEach(e=>{this.scroll.formatAt(t,n,e,i[e])}),t+n},0),t.reduce((t,e)=>"number"==typeof e.delete?(this.scroll.deleteAt(t,e.delete),t):t+(e.retain||e.insert.length||1),0),this.scroll.batchEnd(),this.update(t)}deleteText(t,e){return this.scroll.deleteAt(t,e),this.update((new Delta).retain(t).delete(e))}formatLine(t,e,r={}){return this.scroll.update(),Object.keys(r).forEach(l=>{if(null!=this.scroll.whitelist&&!this.scroll.whitelist[l])return;let n=this.scroll.lines(t,Math.max(e,1)),i=e;n.forEach(e=>{let n=e.length();if(e instanceof CodeBlock){let n=t-e.offset(this.scroll),s=e.newlineIndex(n+i)-n+1;e.formatAt(n,s,l,r[l])}else e.format(l,r[l]);i-=n})}),this.scroll.optimize(),this.update((new Delta).retain(t).retain(e,clone(r)))}formatText(t,e,r={}){return Object.keys(r).forEach(l=>{this.scroll.formatAt(t,e,l,r[l])}),this.update((new Delta).retain(t).retain(e,clone(r)))}getContents(t,e){return this.delta.slice(t,t+e)}getDelta(){return this.scroll.lines().reduce((t,e)=>t.concat(e.delta()),new Delta)}getFormat(t,e=0){let r=[],l=[];0===e?this.scroll.path(t).forEach(function(t){let[e]=t;e instanceof Block?r.push(e):e instanceof Parchment.Leaf&&l.push(e)}):(r=this.scroll.lines(t,e),l=this.scroll.descendants(Parchment.Leaf,t,e));let n=[r,l].map(function(t){if(0===t.length)return{};let e=bubbleFormats(t.shift());for(;Object.keys(e).length>0;){let r=t.shift();if(null==r)return e;e=combineFormats(bubbleFormats(r),e)}return e});return extend.apply(extend,n)}getText(t,e){return this.getContents(t,e).filter(function(t){return"string"==typeof t.insert}).map(function(t){return t.insert}).join("")}insertEmbed(t,e,r){return this.scroll.insertAt(t,e,r),this.update((new Delta).retain(t).insert({[e]:r}))}insertText(t,e,r={}){return e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),this.scroll.insertAt(t,e),Object.keys(r).forEach(l=>{this.scroll.formatAt(t,e.length,l,r[l])}),this.update((new Delta).retain(t).insert(e,clone(r)))}isBlank(){if(0==this.scroll.children.length)return!0;if(this.scroll.children.length>1)return!1;let t=this.scroll.children.head;return t.statics.blotName===Block.blotName&&(!(t.children.length>1)&&t.children.head instanceof Break)}removeFormat(t,e){let r=this.getText(t,e),[l,n]=this.scroll.line(t+e),i=0,s=new Delta;null!=l&&(i=l instanceof CodeBlock?l.newlineIndex(n)-n+1:l.length()-n,s=l.delta().slice(n,n+i-1).insert("\n"));let a=this.getContents(t,e+i).diff((new Delta).insert(r).concat(s)),o=(new Delta).retain(t).concat(a);return this.applyDelta(o)}update(t,e=[],r){let l=this.delta;if(1===e.length&&"characterData"===e[0].type&&e[0].target.data.match(ASCII)&&Parchment.find(e[0].target)){let n=Parchment.find(e[0].target),i=bubbleFormats(n),s=n.offset(this.scroll),a=e[0].oldValue.replace(CursorBlot.CONTENTS,""),o=(new Delta).insert(a),c=(new Delta).insert(n.value());t=(new Delta).retain(s).concat(o.diff(c,r)).reduce(function(t,e){return e.insert?t.insert(e.insert,i):t.push(e)},new Delta),this.delta=l.compose(t)}else this.delta=this.getDelta(),t&&equal(l.compose(t),this.delta)||(t=l.diff(this.delta,r));return t}}function combineFormats(t,e){return Object.keys(e).reduce(function(r,l){return null==t[l]?r:(e[l]===t[l]?r[l]=e[l]:Array.isArray(e[l])?e[l].indexOf(t[l])<0&&(r[l]=e[l].concat([t[l]])):r[l]=[e[l],t[l]],r)},{})}function normalizeDelta(t){return t.reduce(function(t,e){if(1===e.insert){let r=clone(e.attributes);return delete r.image,t.insert({image:e.attributes.image},r)}if(null==e.attributes||!0!==e.attributes.list&&!0!==e.attributes.bullet||((e=clone(e)).attributes.list?e.attributes.list="ordered":(e.attributes.list="bullet",delete e.attributes.bullet)),"string"==typeof e.insert){let r=e.insert.replace(/\r\n/g,"\n").replace(/\r/g,"\n");return t.insert(r,e.attributes)}return t.push(e)},new Delta)}export default Editor;
//# sourceMappingURL=/sm/3e02d4b688919e69211a0667c4537c7ab45b244330e67f89f4afc1f95a9ec4fa.map