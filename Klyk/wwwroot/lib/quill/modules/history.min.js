/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/quill@1.3.7/modules/history.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Parchment from"parchment";import Quill from"../core/quill";import Module from"../core/module";class History extends Module{constructor(t,e){super(t,e),this.lastRecorded=0,this.ignoreChange=!1,this.clear(),this.quill.on(Quill.events.EDITOR_CHANGE,(t,e,s,n)=>{t!==Quill.events.TEXT_CHANGE||this.ignoreChange||(this.options.userOnly&&n!==Quill.sources.USER?this.transform(e):this.record(e,s))}),this.quill.keyboard.addBinding({key:"Z",shortKey:!0},this.undo.bind(this)),this.quill.keyboard.addBinding({key:"Z",shortKey:!0,shiftKey:!0},this.redo.bind(this)),/Win/i.test(navigator.platform)&&this.quill.keyboard.addBinding({key:"Y",shortKey:!0},this.redo.bind(this))}change(t,e){if(0===this.stack[t].length)return;let s=this.stack[t].pop();this.stack[e].push(s),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(s[t],Quill.sources.USER),this.ignoreChange=!1;let n=getLastChangeIndex(s[t]);this.quill.setSelection(n)}clear(){this.stack={undo:[],redo:[]}}cutoff(){this.lastRecorded=0}record(t,e){if(0===t.ops.length)return;this.stack.redo=[];let s=this.quill.getContents().diff(e),n=Date.now();if(this.lastRecorded+this.options.delay>n&&this.stack.undo.length>0){let e=this.stack.undo.pop();s=s.compose(e.undo),t=e.redo.compose(t)}else this.lastRecorded=n;this.stack.undo.push({redo:t,undo:s}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift()}redo(){this.change("redo","undo")}transform(t){this.stack.undo.forEach(function(e){e.undo=t.transform(e.undo,!0),e.redo=t.transform(e.redo,!0)}),this.stack.redo.forEach(function(e){e.undo=t.transform(e.undo,!0),e.redo=t.transform(e.redo,!0)})}undo(){this.change("undo","redo")}}function endsWithNewlineChange(t){let e=t.ops[t.ops.length-1];return null!=e&&(null!=e.insert?"string"==typeof e.insert&&e.insert.endsWith("\n"):null!=e.attributes&&Object.keys(e.attributes).some(function(t){return null!=Parchment.query(t,Parchment.Scope.BLOCK)}))}function getLastChangeIndex(t){let e=t.reduce(function(t,e){return t+=e.delete||0},0),s=t.length()-e;return endsWithNewlineChange(t)&&(s-=1),s}History.DEFAULTS={delay:1e3,maxStack:100,userOnly:!1};export{History as default,getLastChangeIndex};
//# sourceMappingURL=/sm/3fb30435e407b9bd3681413b61e24f6b4d5eaffe7f1edad8342cfe6766c0fe92.map