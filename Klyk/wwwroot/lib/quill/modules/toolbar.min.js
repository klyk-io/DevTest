/**
 * Minified by jsDelivr using Terser v3.14.1.
 * Original file: /npm/quill@1.3.7/modules/toolbar.js
 * 
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import Delta from"quill-delta";import Parchment from"parchment";import Quill from"../core/quill";import logger from"../core/logger";import Module from"../core/module";let debug=logger("quill:toolbar");class Toolbar extends Module{constructor(t,e){if(super(t,e),Array.isArray(this.options.container)){let e=document.createElement("div");addControls(e,this.options.container),t.container.parentNode.insertBefore(e,t.container),this.container=e}else"string"==typeof this.options.container?this.container=document.querySelector(this.options.container):this.container=this.options.container;if(!(this.container instanceof HTMLElement))return debug.error("Container required for toolbar",this.options);this.container.classList.add("ql-toolbar"),this.controls=[],this.handlers={},Object.keys(this.options.handlers).forEach(t=>{this.addHandler(t,this.options.handlers[t])}),[].forEach.call(this.container.querySelectorAll("button, select"),t=>{this.attach(t)}),this.quill.on(Quill.events.EDITOR_CHANGE,(t,e)=>{t===Quill.events.SELECTION_CHANGE&&this.update(e)}),this.quill.on(Quill.events.SCROLL_OPTIMIZE,()=>{let[t]=this.quill.selection.getRange();this.update(t)})}addHandler(t,e){this.handlers[t]=e}attach(t){let e=[].find.call(t.classList,t=>0===t.indexOf("ql-"));if(!e)return;if(e=e.slice("ql-".length),"BUTTON"===t.tagName&&t.setAttribute("type","button"),null==this.handlers[e]){if(null!=this.quill.scroll.whitelist&&null==this.quill.scroll.whitelist[e])return void debug.warn("ignoring attaching to disabled format",e,t);if(null==Parchment.query(e))return void debug.warn("ignoring attaching to nonexistent format",e,t)}let l="SELECT"===t.tagName?"change":"click";t.addEventListener(l,l=>{let i;if("SELECT"===t.tagName){if(t.selectedIndex<0)return;let e=t.options[t.selectedIndex];i=!e.hasAttribute("selected")&&(e.value||!1)}else i=!t.classList.contains("ql-active")&&(t.value||!t.hasAttribute("value")),l.preventDefault();this.quill.focus();let[n]=this.quill.selection.getRange();if(null!=this.handlers[e])this.handlers[e].call(this,i);else if(Parchment.query(e).prototype instanceof Parchment.Embed){if(!(i=prompt(`Enter ${e}`)))return;this.quill.updateContents((new Delta).retain(n.index).delete(n.length).insert({[e]:i}),Quill.sources.USER)}else this.quill.format(e,i,Quill.sources.USER);this.update(n)}),this.controls.push([e,t])}update(t){let e=null==t?{}:this.quill.getFormat(t);this.controls.forEach(function(l){let[i,n]=l;if("SELECT"===n.tagName){let l;if(null==t)l=null;else if(null==e[i])l=n.querySelector("option[selected]");else if(!Array.isArray(e[i])){let t=e[i];"string"==typeof t&&(t=t.replace(/\"/g,'\\"')),l=n.querySelector(`option[value="${t}"]`)}null==l?(n.value="",n.selectedIndex=-1):l.selected=!0}else if(null==t)n.classList.remove("ql-active");else if(n.hasAttribute("value")){let t=e[i]===n.getAttribute("value")||null!=e[i]&&e[i].toString()===n.getAttribute("value")||null==e[i]&&!n.getAttribute("value");n.classList.toggle("ql-active",t)}else n.classList.toggle("ql-active",null!=e[i])})}}function addButton(t,e,l){let i=document.createElement("button");i.setAttribute("type","button"),i.classList.add("ql-"+e),null!=l&&(i.value=l),t.appendChild(i)}function addControls(t,e){Array.isArray(e[0])||(e=[e]),e.forEach(function(e){let l=document.createElement("span");l.classList.add("ql-formats"),e.forEach(function(t){if("string"==typeof t)addButton(l,t);else{let e=Object.keys(t)[0],i=t[e];Array.isArray(i)?addSelect(l,e,i):addButton(l,e,i)}}),t.appendChild(l)})}function addSelect(t,e,l){let i=document.createElement("select");i.classList.add("ql-"+e),l.forEach(function(t){let e=document.createElement("option");!1!==t?e.setAttribute("value",t):e.setAttribute("selected","selected"),i.appendChild(e)}),t.appendChild(i)}Toolbar.DEFAULTS={},Toolbar.DEFAULTS={container:null,handlers:{clean:function(){let t=this.quill.getSelection();if(null!=t)if(0==t.length){let t=this.quill.getFormat();Object.keys(t).forEach(t=>{null!=Parchment.query(t,Parchment.Scope.INLINE)&&this.quill.format(t,!1)})}else this.quill.removeFormat(t,Quill.sources.USER)},direction:function(t){let e=this.quill.getFormat().align;"rtl"===t&&null==e?this.quill.format("align","right",Quill.sources.USER):t||"right"!==e||this.quill.format("align",!1,Quill.sources.USER),this.quill.format("direction",t,Quill.sources.USER)},indent:function(t){let e=this.quill.getSelection(),l=this.quill.getFormat(e),i=parseInt(l.indent||0);if("+1"===t||"-1"===t){let e="+1"===t?1:-1;"rtl"===l.direction&&(e*=-1),this.quill.format("indent",i+e,Quill.sources.USER)}},link:function(t){!0===t&&(t=prompt("Enter link URL:")),this.quill.format("link",t,Quill.sources.USER)},list:function(t){let e=this.quill.getSelection(),l=this.quill.getFormat(e);"check"===t?"checked"===l.list||"unchecked"===l.list?this.quill.format("list",!1,Quill.sources.USER):this.quill.format("list","unchecked",Quill.sources.USER):this.quill.format("list",t,Quill.sources.USER)}}};export{Toolbar as default,addControls};
//# sourceMappingURL=/sm/435d9b5c84a080d640dabc8a2082283f291e35c4dca86a7e251668def8d4341e.map